<script type="text/javascript">
    RED.nodes.registerType('unifi-access-controller', {
        category: 'config',
        defaults: {
            name: {
                value: '',
                required: true,
            },
            controllerIp: {
                value: '',
                required: true,
            },
            controllerPort: {
                value: '',
                required: false,
            },
            wsPort: {
                value: '',
                required: false,
            },
            controllerType: {
                value: 'UniFiOSConsole',
                required: true,
            },
            protectSocketReconnectTimeout: {
                value: 0,
                validate: RED.validators.number(),
                required: true,
            },
            protectSocketHeartbeatInterval: {
                value: 0,
                validate: RED.validators.number(),
                required: true,
            },
        },
        oneditprepare: restoreValue,
        oneditsave: storeAsNumber,
        credentials: {
            username: { type: 'text' },
            password: { type: 'password' },
        },
        label: function () {
            return this.name || 'unifi-access-controller'
        },
        labelStyle: function () {
            return this.name ? 'node_label_italic' : ''
        },
    })

    function storeAsNumber() {
        const el_protectSocketReconnectTimeout = $(
            '#el-node-config-input-protectSocketReconnectTimeout'
        )
        this.protectSocketReconnectTimeout = parseInt(
            el_protectSocketReconnectTimeout.val()
        )

        const el_protectSocketHeartbeatInterval = $(
            '#el-node-config-input-protectSocketHeartbeatInterval'
        )
        this.protectSocketHeartbeatInterval = parseInt(
            el_protectSocketHeartbeatInterval.val()
        )
    }
    function restoreValue() {
        const reconnectValue = this.protectSocketReconnectTimeout || 0
        const heartBeatValue = this.protectSocketHeartbeatInterval || 0
        $('#el-node-config-input-protectSocketReconnectTimeout').val(
            reconnectValue
        )
        $('#el-node-config-input-protectSocketHeartbeatInterval').val(
            heartBeatValue
        )
    }
</script>

<!-- prettier-ignore -->
<script data-template-name="unifi-access-controller" type="text/html">
    <div class="form-row unifi-flex">
        <label for="node-config-input-name" class="unifi-width-50"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-config-input-name"  class="unifi-grow" placeholder="Name"/>
    </div>
    <div class="unifi-text-divider">Controller</div>
    <div class="form-row unifi-flex">
        <label for="node-config-input-controllerIp" class="unifi-width-50"><i class="fa fa-globe"></i> IP</label>
        <input type="text" id="node-config-input-controllerIp" class="unifi-grow" placeholder="Controller IP"/>
    </div>
    <div class="form-row unifi-flex">
        <label for="node-config-input-controllerPort" class="unifi-width-50"><i class="fa fa-globe"></i> Port (HTTP)</label>
        <input type="text" id="node-config-input-controllerPort"  class="unifi-grow" placeholder="-- Use Type Default --"/>
    </div>
    <div class="form-row unifi-flex">
        <label for="node-config-input-wsPort" class="unifi-width-50"><i class="fa fa-globe"></i> Port (WS)</label>
        <input type="text" id="node-config-input-wsPort"  class="unifi-grow" placeholder="-- Use Type Default --"/>
    </div>
    <div class="form-row unifi-flex">
        <label for="node-config-input-controllerType" class="unifi-width-50"><i class="fa fa-server"></i> Type</label>
        <select id="node-config-input-controllerType" class="unifi-grow">
            <option value="UniFiOSConsole" selected="selected">
                UniFi OS Console
            </option>
            <option value="UniFiNetworkApplication">
                UniFi Network Application
            </option>
        </select>
    </div>
    <div class="unifi-text-divider">Protect Shared Socket timeouts (ms, 0 - Use defaults)</div>
    <div class="form-row unifi-flex">
        <label for="el-node-config-input-protectSocketReconnectTimeout" class="unifi-width-50"><i class="fa fa-clock-o"></i> Reconnect</label>
        <input type="number" id="el-node-config-input-protectSocketReconnectTimeout" class="unifi-grow" placeholder="30000"/>
    </div>
    <div class="form-row unifi-flex">
        <label for="el-node-config-input-protectSocketHeartbeatInterval" class="unifi-width-50"><i class="fa fa-clock-o"></i> Heartbeat</label>
        <input type="number" id="el-node-config-input-protectSocketHeartbeatInterval" class="unifi-grow" placeholder="15000"/>
    </div>
    <div class="unifi-text-divider">Credentials</div>
    <div class="form-row unifi-flex">
        <label for="node-config-input-username" class="unifi-width-50"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-config-input-username" class="unifi-grow" placeholder="Username"/>
    </div>
    <div class="form-row unifi-flex">
        <label for="node-config-input-password" class="unifi-width-50" ><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-config-input-password"  class="unifi-grow" placeholder="Password"/>
    </div>
</script>

<!-- prettier-ignore -->
<script data-help-name="unifi-access-controller" type="text/html">
    <p>
        A simple node that logs into Unifi OS and sends the cookies to a single
        output.
    </p>
</script>
